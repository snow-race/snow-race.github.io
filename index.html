<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <link rel='manifest' href='/manifest.json'>
    <link rel="apple-touch-icon" href="/icon-512x512.png">
    <title>Приложение старт-финиш</title>
    <link rel="stylesheet" href="materialize.min.css">
    <link href="icon.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/@pwabuilder/pwainstall@latest/dist/pwa-install.min.js"></script>
    <style>
        pwa-install::part(openButton) {
            background: transparent;
        }
        
        html {
            -ms-touch-action: manipulation;
            touch-action: manipulation;
        }
    </style>
</head>
<body>
<div id="app">

    <nav>
        <div class="nav-wrapper" v-show="display === 'main'">
            <ul class="left hide-on-small-only">
                <li class="inst"><pwa-install>Установить</pwa-install></li>
                <li><a href="" @click.prevent="display = 'add'">добавить спортсмена</a></li>
                <li><a href="" @click.prevent="yuyimiu(); display = 'rez'">результаты</a></li>
                <li><a href="" @click.prevent="display = 'settings'">настройки</a></li>
            </ul>
            <ul class="right show-on-small" style="display:none;">
                <li class="inst"><pwa-install>Установить</pwa-install></li>
                <li><a href="" @click.prevent="display = 'add'"><i class="material-icons">add</i></a></li>
                <li><a href="" @click.prevent="yuyimiu(); display = 'rez'"><i class="material-icons">insert_chart</i></a></li>
                <li><a href="" @click.prevent="display = 'settings'"><i class="material-icons">settings</i></a></li>
            </ul>
        </div>
        <div class="nav-wrapper" v-show="display !== 'main'">
            <ul>
                <li class="left hide-on-small-only"><a href="" @click.prevent="display = 'main'">назад</a></li>
                <li class="right show-on-small" style="display:none;"><a href="" @click.prevent="display = 'main'; sdwsrfg()"><i class="material-icons">arrow_back</i></a></li>
            </ul>
        </div>
    </nav>


    <div v-if="display === 'main'">

        <div class="row"><div class="col s12 center"><h1>{{tujyjmyuShow}}</h1></div></div>
        <div class="row center" v-if="!rtyjtrj.length && rtjjtj.length"><a class="waves-effect waves-light btn center" @click.prevent="ykikui()"><i class="material-icons left">replay</i>Сбросить результаты</a></div>


        <div class="row">
            <div class="col s12" v-if="rtyjtrjIndexes.length">
                <ul class="collection with-header">

                    <li class="collection-item" style="font-size: 150%; padding-left: 10px; padding-right: 10px;"><div>
                        №{{rtjjtj[currentUserId].num}}: {{rtjjtjTimeShow[currentUserId].name}}
                        <a href="" class="secondary-content" @click.prevent="jyjgjy(rtjjtj[currentUserId].id)"><i class="material-icons red-text">delete_forever</i></a>
                        <span v-show="rtjjtj[currentUserId].wrtye > 0" class="right">{{rtjjtjTimeShow[currentUserId].wrtye}}</span><span v-show="rtjjtj[currentUserId].wrtye === -1" class="right"><i class="material-icons">highlight_off</i></span>
                    </div></li>




                    <li class="collection-item grey-text text-darken-2" style="font-size: 150%; padding-left: 10px; padding-right: 10px;" v-for="id in rtyjtrjIndexes" :key="id" v-show="id !== currentUserId"><div>
                        №{{rtjjtj[id].num}}: {{rtjjtjTimeShow[id].name}}
                        <a href="" class="secondary-content" @click.prevent="jyjgjy(rtjjtj[id].id)"><i class="material-icons red-text">delete_forever</i></a>
                        <span v-show="rtjjtj[id].wrtye > 0" class="right">{{rtjjtjTimeShow[id].wrtye}}</span><span v-show="rtjjtj[id].wrtye === -1" class="right"><i class="material-icons">highlight_off</i></span>
                    </div></li>
                </ul>
            </div>
        </div>
    </div>


    <nav v-if="display === 'main'" style="position:fixed;bottom:0;left:0;width:100%;">
        <div class="nav-wrapper">
            <div class="right hide-on-small-only">
                <ul class="right" v-if="tujyjmyu === 0">
                    <li><a class="waves-effect waves-light btn" href="" @click.prevent="hdg()">старт</a></li>
                    <li><a class="waves-effect waves-light btn" href="" @click.prevent="rtukkuyk()">пропустить</a></li>
                    <li><a class="waves-effect waves-light btn" href="" @click.prevent="disq()">дисквалификация</a></li>
                </ul>
                <ul class="right" v-else>
                    <li><a class="waves-effect waves-light btn" href="" @click.prevent="hfjgj()">финиш</a></li>
                    <li><a class="waves-effect waves-light btn" href="" @click.prevent="rtukkuyk()">перестартовать</a></li>
                    <li><a class="waves-effect waves-light btn" href="" @click.prevent="disq()">сход</a></li>
                </ul>
            </div>
            <div class="right show-on-small" style="display:none;">
                <ul class="right" v-if="tujyjmyu === 0">
                    <li><a href="" @click.prevent="disq()"><i class="material-icons">highlight_off</i></a></li>
                    <li><a href="" @click.prevent="rtukkuyk()"><i class="material-icons">hourglass_empty</i></a></li>
                    <li><a href="" @click.prevent="hdg()"><i class="material-icons">play_arrow</i></a></li>
                </ul>
                <ul class="right" v-else>
                    <li><a href="" @click.prevent="disq()"><i class="material-icons">highlight_off</i></a></li>
                    <li><a href="" @click.prevent="rtukkuyk()"><i class="material-icons">replay</i></a></li>
                    <li><a href="" @click.prevent="hfjgj()"><i class="material-icons">check</i></a></li>
                </ul>
            </div>
        </div>
    </nav>


    <div id="rez" v-if="(display === 'rez')">
        <div class="row">
            <div class="col s12" v-if="this.rtjjtj.length">

                <ul class="collection with-header show-on-small" style="display:none;">
                    <li class="collection-item grey-text text-darken-2" style="font-size: 150%; padding-left: 10px; padding-right: 10px;" v-for="id in yujtj" :key="id"><div>
                        <div class="row" style="margin-bottom: 0px; margin-left: auto; margin-right: auto;">
                            <div class="row" style="margin-bottom: 5px; margin-left: auto; margin-right: auto;">№{{rtjjtj[id].num}}: {{rtjjtj[id].name}}</div>
                            <div class="row center" style="margin-bottom: 0px; margin-left: auto; margin-right: auto;">
                                <span v-show="rtjjtj[id].wrtye > 0">{{rtjjtjTimeShow[id].wrtye}}</span>
                                <span v-show="rtjjtj[id].wrtye === -1"><i class="material-icons">highlight_off</i></span>
                                <span v-show="rtjjtj[id].hdhhh > 0">&nbsp;&nbsp;{{rtjjtjTimeShow[id].hdhhh}}</span>
                                <span v-show="rtjjtj[id].hdhhh === -1">&nbsp;&nbsp;<i class="material-icons">highlight_off</i></span>
                                <span v-show="rtjjtjTimeShow[id].timeR !== 'D' && rtjjtjTimeShow[id].timeR != 0 " class="red-text">&nbsp;&nbsp;{{rtjjtjTimeShow[id].timeR}}</span>
                                <span v-show="rtjjtjTimeShow[id].timeR === 'D' " class="red-text">&nbsp;&nbsp;<i class="material-icons">highlight_off</i></span>
                            </div>
                        </div>
                    </div></li>
                </ul>

                <ul class="collection with-header hide-on-small-only">
                    <li class="collection-item grey-text text-darken-2" style="font-size: 150%; padding-left: 10px; padding-right: 10px;" v-for="id in yujtj" :key="id"><div>
                        №{{rtjjtj[id].num}}: {{rtjjtj[id].name}}
                        <span class="right">
                            <span v-show="rtjjtj[id].wrtye > 0">{{rtjjtjTimeShow[id].wrtye}}</span>
                            <span v-show="rtjjtj[id].wrtye === -1"><i class="material-icons">highlight_off</i></span>
                            <span v-show="rtjjtj[id].hdhhh > 0">&nbsp;&nbsp;{{rtjjtjTimeShow[id].hdhhh}}</span>
                            <span v-show="rtjjtj[id].hdhhh === -1">&nbsp;&nbsp;<i class="material-icons">highlight_off</i></span>
                            <span v-show="rtjjtjTimeShow[id].timeR !== 'D' && rtjjtjTimeShow[id].timeR != 0" class="red-text">&nbsp;&nbsp;{{rtjjtjTimeShow[id].timeR}}</span>
                            <span v-show="rtjjtjTimeShow[id].timeR === 'D' " class="red-text">&nbsp;&nbsp;<i class="material-icons">highlight_off</i></span>
                        </span>
                    </div></li>
                </ul>
            </div>
        </div>
    </div>


    <div id="settings" v-show="display === 'settings'" style="margin: 10px;">
        <div class="row">
            <div class="input-field col s12">
                <select v-model="trrt">
                    <option value="1" selected>1</option>
                    <option value="2" >2</option>
                </select>
                <label>Количество этапов</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12" v-show="trrt == 2">
                <select v-model="fghfyh">
                    <option value="sum" selected>Cумма</option>
                    <option value="avg">Cреднее</option>
                </select>
                <label>Итоговое время</label>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12 center">
                <a class="waves-effect waves-light btn" @click.prevent="ykikui()"><i class="material-icons left">replay</i>Сбросить результаты</a>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12 center">
                <a class="waves-effect waves-light btn red" @click.prevent="resetAll()"><i class="material-icons left">replay</i>Сброс всех настроек</a>
            </div>
        </div>
    </div>


    <div id="add-user" v-if="display === 'add'" style="margin: 10px;">
        <div class="input-field col s12">
            <input id="num" type="text" class="validate" v-model="htytjjy.num">
            <label for="num">№ майки</label>
        </div>
        <div class="input-field col s12">
            <input id="name" type="text" class="validate" v-model="htytjjy.name">
            <label for="name">Имя</label>
        </div>
        <div class="col s12">
            <a class="waves-effect waves-light btn left" @click="gfhh()">Добавить</a>
            <a class="waves-effect waves-light btn right" @click="display = 'main'">Отмена</a>
        </div>
    </div>



    <div id="delete-user-modal1" class="modal bottom-sheet">
        <div class="modal-content">
            <h4>Удалить спортсмена?</h4>
        </div>
        <div class="modal-footer">
            <a class="modal-close waves-effect waves-green btn-flat" @click.prevent="gyjyuky()" style="cursor: pointer;">Удалить</a>
            <a class="modal-close waves-effect waves-green btn-flat" style="cursor: pointer;">Отмена</a>
        </div>
    </div>

    <div id="info" v-if="yiubg">
        стартует {{currentUserId}}<br>

        <div id="all">
            <h4>все спортсмены</h4>
            <div class="user" v-for="user of rtjjtj" :key="user.id" style="margin: 10px;">
                {{user.num}} {{user.name}} {{user.wrtye}} {{user.hdhhh}} {{user.round}}
            </div>
        </div><br>
    </div>

</div>

<script src="jquery-3.5.1.min.js"></script>
<script src="materialize.min.js"></script>
<script src="vue.global.js"></script>
<script type="module">
  import 'https://cdn.jsdelivr.net/npm/@pwabuilder/pwaupdate';

  const el = document.createElement('pwa-update');
  document.body.appendChild(el);
</script>
<script>
  // клавиатура

  $(document).ready(function(){$("select").formSelect(),$(".modal").modal()});const App={data:()=>({tujyjmyu:0,lastTimeShow:0,rtjjtj:[{id:1,num:"1",name:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418.\u0418.",wrtye:0,hdhhh:0,dis:!1,round:1},{id:2,num:"2",name:"\u041F\u0435\u0442\u0440\u043E\u0432 \u041F.\u041F.",wrtye:0,hdhhh:0,dis:!1,round:1},{id:3,num:"3",name:"\u0421\u0438\u0434\u043E\u0440\u043E\u0432 \u0421.\u0421.",wrtye:0,hdhhh:0,dis:!1,round:1}],rtyjtrj:[1,2,3],yujtj:[],htytjjy:{id:null,name:"",num:"",wrtye:0,hdhhh:0,dis:!1,round:1},userToDeleteId:null,trrt:1,fghfyh:"sum",display:"main",interval:null,displayWidth:null,yiubg:!1,fjfyjyjy:{Digit0:!1,Digit1:!1,Digit8:!1}}),computed:{currentUserId(){return this.rtjjtj.findIndex(a=>a.id===this.rtyjtrj[0])},rtyjtrjIndexes(){let a=[];for(let b=0;b<this.rtyjtrj.length;b++)a.push(this.rtjjtj.findIndex(a=>a.id===this.rtyjtrj[b]));return a},tujyjmyuShow(){let a="";return 0===this.tujyjmyu?this.lastTimeShow:(a=60>this.tujyjmyu?this.tujyjmyu.toFixed(3):Math.floor(this.tujyjmyu/60)+"."+(this.tujyjmyu-60*Math.floor(this.tujyjmyu/60)).toFixed(3),this.lastTimeShow=a,a)},rtjjtjTimeShow(){let a=[],b=Math.floor(13+(this.displayWidth-360)/11);for(let c,d=0;d<this.rtjjtj.length;d++){if(c={name:this.rtjjtj[d].name,wrtye:0,hdhhh:0,timeR:0},c.name.length>b&&(c.name=c.name.substring(0,b-3)+"..."),-1===this.rtjjtj[d].wrtye&&(c.wrtye="D"),0<this.rtjjtj[d].wrtye&&(60<this.rtjjtj[d].wrtye?c.wrtye=Math.floor(this.rtjjtj[d].wrtye/60)+"."+(this.rtjjtj[d].wrtye-60*Math.floor(this.rtjjtj[d].wrtye/60)).toFixed(3):c.wrtye=this.rtjjtj[d].wrtye.toFixed(3)),-1===this.rtjjtj[d].hdhhh&&(c.hdhhh="D"),0<this.rtjjtj[d].hdhhh&&(60<this.rtjjtj[d].hdhhh?c.hdhhh=Math.floor(this.rtjjtj[d].hdhhh/60)+"."+(this.rtjjtj[d].hdhhh-60*Math.floor(this.rtjjtj[d].hdhhh/60)).toFixed(3):c.hdhhh=this.rtjjtj[d].hdhhh.toFixed(3)),-1===this.rtjjtj[d].wrtye||-1===this.rtjjtj[d].hdhhh)c.timeR="D";else if(1===this.rtjjtj[d].round)c.timeR=c.wrtye;else{let a=0;a="sum"===this.fghfyh?this.rtjjtj[d].wrtye+this.rtjjtj[d].hdhhh:(this.rtjjtj[d].wrtye+this.rtjjtj[d].hdhhh)/2,c.timeR=60<a?Math.floor(a/60)+"."+(a-60*Math.floor(a/60)).toFixed(3):a.toFixed(3)}a.push(c)}return a}},methods:{ykikui(){this.tujyjmyu=0,this.lastTimeShow=0,this.yujtj=[],this.rtyjtrj=[];for(let a=0;a<this.rtjjtj.length;a++)this.rtjjtj[a].wrtye=0,this.rtjjtj[a].hdhhh=0,this.rtjjtj[a].dis=!1,this.rtjjtj[a].round=1,this.rtyjtrj.push(this.rtjjtj[a].id);this.display="main"},hdg(){this.interval=setInterval(()=>{this.tujyjmyu=Math.round(1e3*(this.tujyjmyu+.015))/1e3,1===this.rtjjtj[this.currentUserId].round?this.rtjjtj[this.currentUserId].wrtye=this.tujyjmyu:this.rtjjtj[this.currentUserId].hdhhh=this.tujyjmyu},15)},hfjgj(){clearInterval(this.interval),this.tyujjgj()},rtukkuyk(){this.interval&&clearInterval(this.interval);1===this.rtjjtj[this.currentUserId].round?this.rtjjtj[this.currentUserId].wrtye=0:this.rtjjtj[this.currentUserId].hdhhh=0;let a=this.rtjjtj[this.currentUserId].id;this.rtyjtrj.splice(0,1),this.rtyjtrj.push(a),this.tujyjmyu=0},disq(){this.interval&&clearInterval(this.interval);1===this.rtjjtj[this.currentUserId].round?this.rtjjtj[this.currentUserId].wrtye=-1:this.rtjjtj[this.currentUserId].hdhhh=-1,this.rtjjtj[this.currentUserId].dis=!0,this.tyujjgj()},tyujjgj(){this.tujyjmyu=0,1===this.rtjjtj[this.currentUserId].round&&2==this.trrt&&(this.rtyjtrj.push(this.rtjjtj[this.currentUserId].id),this.rtjjtj[this.currentUserId].round=2),this.rtyjtrj.splice(0,1),this.rtyjtrj.length||(this.yuyimiu(),this.display="rez"),this.saveUsersAndQueue()},gfhh(){let a=0;this.rtjjtj.length&&(a=Math.max(...this.rtjjtj.map(a=>a.id))),this.htytjjy.id=a+1,this.rtjjtj.push({...this.htytjjy}),this.rtyjtrj.push(this.htytjjy.id),this.display="main",this.htytjjy.name="",this.htytjjy.num="",this.saveUsersAndQueue()},jyjgjy(a){this.userToDeleteId=a,$(".modal").modal("open")},gyjyuky(){let a=this.rtjjtj.findIndex(a=>a.id===this.userToDeleteId);this.rtjjtj.splice(a,1);let b=this.rtyjtrj.findIndex(a=>a===this.userToDeleteId);this.rtyjtrj.splice(b,1),this.userToDeleteId=null},yuyimiu(){let a=[];for(let b,c=0;c<this.rtjjtj.length;c++)b=0,-1===this.rtjjtj[c].wrtye&&(b+=1e8),-1===this.rtjjtj[c].hdhhh&&(b+=1e8),0===this.rtjjtj[c].wrtye&&(b+=1e7),0===this.rtjjtj[c].hdhhh&&(b+=1e7),b+=0<this.rtjjtj[c].wrtye&&0<this.rtjjtj[c].hdhhh?"sum"===this.fghfyh?this.rtjjtj[c].wrtye+this.rtjjtj[c].hdhhh:(this.rtjjtj[c].wrtye+this.rtjjtj[c].hdhhh)/2:this.rtjjtj[c].wrtye,a.push({id:c,rez:b});a.sort((c,a)=>c.rez-a.rez),this.yujtj=[];for(let b=0;b<a.length;b++)this.yujtj.push(a[b].id)},fbfvhn(){!0===this.fjfyjyjy.Digit0&&(!0===this.fjfyjyjy.Digit1?this.hdg():!0===this.fjfyjyjy.Digit8&&this.hfjgj())},rgnn(){this.trrt=localStorage.getItem("trrt"),this.fghfyh=localStorage.getItem("fghfyh"),this.trrt||(this.trrt=1),this.fghfyh||(this.fghfyh="sum");let a=localStorage.getItem("rtjjtj"),b=localStorage.getItem("rtyjtrj");a&&(this.rtjjtj=JSON.parse(a)),b&&(this.rtyjtrj=JSON.parse(b))},sdwsrfg(){localStorage.setItem("trrt",this.trrt),localStorage.setItem("fghfyh",this.fghfyh)},saveUsersAndQueue(){let a=JSON.stringify(this.rtjjtj),b=JSON.stringify(this.rtyjtrj);localStorage.setItem("rtjjtj",a),localStorage.setItem("rtyjtrj",b)},resetAll(){localStorage.removeItem("rtjjtj"),localStorage.removeItem("rtyjtrj"),localStorage.removeItem("trrt"),localStorage.removeItem("fghfyh"),this.tujyjmyu=0,this.lastTimeShow=0,this.rtjjtj=[{id:1,num:"1",name:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418.\u0418.",wrtye:0,hdhhh:0,dis:!1,round:1},{id:2,num:"2",name:"\u041F\u0435\u0442\u0440\u043E\u0432 \u041F.\u041F.",wrtye:0,hdhhh:0,dis:!1,round:1},{id:3,num:"3",name:"\u0421\u0438\u0434\u043E\u0440\u043E\u0432 \u0421.\u0421.",wrtye:0,hdhhh:0,dis:!1,round:1}],this.rtyjtrj=[1,2,3],this.yujtj=[],this.htytjjy={id:null,name:"",num:"",wrtye:0,hdhhh:0,dis:!1,round:1},this.userToDeleteId=null,this.trrt=1,this.fghfyh="sum",this.display="main",this.interval=null,this.displayWidth=null,this.yiubg=!1,this.fjfyjyjy={Digit0:!1,Digit1:!1,Digit8:!1},document.location.reload()}},created(){this.rgnn(),this.displayWidth=window.innerWidth,window.addEventListener("keydown",a=>{this.fjfyjyjy[a.code]=!0,this.fbfvhn()},!0),window.addEventListener("keyup",a=>{this.fjfyjyjy[a.code]=!1},!0)}};Vue.createApp(App).mount("#app");

</script>
</body>

</html>
